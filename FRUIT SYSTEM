-- REZO HUB - Fruit System
local FruitSystem = {}
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local RezoHub = nil

function FruitSystem:Initialize(config)
    self.Config = config
    RezoHub = _G.RezoHub or require(script.Parent.MainScript)
    self.Active = false
    self.CurrentFruits = {}
    
    print("âœ… Fruit System inicializado")
end

function FruitSystem:Update()
    if not self.Config.AutoFarmFruits or not self.Active then
        return
    end
    
    self:ScanForFruits()
    self:CollectNearestFruit()
end

function FruitSystem:ScanForFruits()
    self.CurrentFruits = {}
    
    local fruitNames = {
        "Ice", "Dark", "Light", "Magma", "Quake", "Bomb",
        "Spike", "Flame", "Sand", "Ghost", "Diamond", "Rubber"
    }
    
    for _, fruitName in ipairs(fruitNames) do
        local fruit = workspace:FindFirstChild(fruitName)
        if fruit and fruit:IsA("Part") then
            table.insert(self.CurrentFruits, fruit)
        end
    end
end

function FruitSystem:CollectNearestFruit()
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
    
    local nearestFruit = nil
    local shortestDistance = self.Config.FruitRange
    
    for _, fruit in ipairs(self.CurrentFruits) do
        local distance = (fruit.Position - rootPart.Position).Magnitude
        if distance < shortestDistance then
            shortestDistance = distance
            nearestFruit = fruit
        end
    end
    
    if nearestFruit then
        humanoid:MoveTo(nearestFruit.Position)
        
        if shortestDistance < 10 then
            if nearestFruit:FindFirstChild("ClickDetector") then
                fireclickdetector(nearestFruit.ClickDetector)
                if self.Config.DebugMode then
                    print("ðŸŠ Fruta recolectada: " .. nearestFruit.Name)
                end
            end
        end
    end
end

function FruitSystem:StartFarming()
    self.Active = true
    print("ðŸŒ± Auto Farm de Frutas ACTIVADO")
end

function FruitSystem:StopFarming()
    self.Active = false
    print("ðŸŒ± Auto Farm de Frutas DESACTIVADO")
end

function FruitSystem:GetFruitCount()
    return #self.CurrentFruits
end

return FruitSystem
