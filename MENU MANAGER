-- REZO HUB - Menu Manager
local MenuManager = {}
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local RezoHub = nil

function MenuManager:Initialize(config)
    self.Config = config
    RezoHub = _G.RezoHub or require(script.Parent.MainScript)
    self:CreateInterface()
    self:SetupDragFunctionality()
end

function MenuManager:CreateInterface()
    -- GUI Principal
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "RezoHubGUI"
    self.ScreenGui.Parent = player:WaitForChild("PlayerGui")
    
    -- Marco Principal
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Name = "MainFrame"
    self.MainFrame.Size = UDim2.new(0, 400, 0, 500)
    self.MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
    self.MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    self.MainFrame.Parent = self.ScreenGui
    
    -- Efecto de sombra
    local shadow = Instance.new("UIStroke")
    shadow.Color = Color3.fromRGB(0, 255, 255)
    shadow.Thickness = 2
    shadow.Parent = self.MainFrame
    
    -- Header
    self:CreateHeader()
    
    -- Panel de Navegaci√≥n
    self:CreateNavigation()
    
    -- Panel de Contenido
    self:CreateContentPanel()
    
    -- Footer
    self:CreateFooter()
end

function MenuManager:CreateHeader()
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 50)
    header.Position = UDim2.new(0, 0, 0, 0)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    header.BorderSizePixel = 0
    header.Parent = self.MainFrame
    
    -- T√≠tulo
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(0, 200, 1, 0)
    title.Position = UDim2.new(0, 15, 0, 0)
    title.Text = "‚ö° REZO HUB"
    title.TextColor3 = Color3.fromRGB(0, 255, 255)
    title.BackgroundTransparency = 1
    title.TextSize = 20
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = header
    
    -- Bot√≥n de cerrar
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseButton"
    closeBtn.Size = UDim2.new(0, 30, 0, 30)
    closeBtn.Position = UDim2.new(1, -35, 0, 10)
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    closeBtn.BorderSizePixel = 0
    closeBtn.Parent = header
    
    closeBtn.MouseButton1Click:Connect(function()
        self.ScreenGui.Enabled = not self.ScreenGui.Enabled
    end)
end

function MenuManager:CreateNavigation()
    local navFrame = Instance.new("Frame")
    navFrame.Name = "Navigation"
    navFrame.Size = UDim2.new(0, 100, 1, -100)
    navFrame.Position = UDim2.new(0, 0, 0, 50)
    navFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    navFrame.BorderSizePixel = 0
    navFrame.Parent = self.MainFrame
    
    local buttons = {
        {"Fruits", "üçé", "Sistema de Frutas"},
        {"Chests", "üì¶", "Sistema de Cofres"},
        {"Skills", "‚ö°", "Sistema de Habilidades"},
        {"Settings", "‚öôÔ∏è", "Configuraci√≥n"}
    }
    
    for i, btnData in ipairs(buttons) do
        self:CreateNavButton(navFrame, btnData[1], btnData[2], btnData[3], i)
    end
end

function MenuManager:CreateNavButton(parent, name, icon, tooltip, index)
    local button = Instance.new("TextButton")
    button.Name = name .. "Button"
    button.Size = UDim2.new(1, -10, 0, 40)
    button.Position = UDim2.new(0, 5, 0, (index-1) * 45 + 10)
    button.Text = icon .. " " .. name
    button.TextColor3 = Color3.fromRGB(200, 200, 200)
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    button.BorderSizePixel = 0
    button.TextSize = 12
    button.Parent = parent
    
    button.MouseButton1Click:Connect(function()
        self:SwitchTab(name)
    end)
end

function MenuManager:CreateContentPanel()
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "ContentFrame"
    contentFrame.Size = UDim2.new(1, -100, 1, -100)
    contentFrame.Position = UDim2.new(0, 100, 0, 50)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = self.MainFrame
    
    -- Crear pesta√±as de contenido
    self:CreateFruitsTab(contentFrame)
    self:CreateChestsTab(contentFrame)
    self:CreateSkillsTab(contentFrame)
    self:CreateSettingsTab(contentFrame)
    
    -- Mostrar primera pesta√±a por defecto
    self:SwitchTab("Fruits")
end

function MenuManager:CreateFruitsTab(parent)
    local tab = Instance.new("Frame")
    tab.Name = "FruitsTab"
    tab.Size = UDim2.new(1, 0, 1, 0)
    tab.BackgroundTransparency = 1
    tab.Visible = false
    tab.Parent = parent
    
    -- Toggle Auto Farm
    local autoFarm = self:CreateToggle("Auto Farm Frutas", false, tab, 20)
    local rangeSlider = self:CreateSlider("Rango", 10, 100, 50, tab, 70)
    
    -- Info de frutas
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, -20, 0, 80)
    infoLabel.Position = UDim2.new(0, 10, 0, 120)
    infoLabel.Text = "üçä Sistema de Frutas\n\n‚Ä¢ Auto-detectar frutas\n‚Ä¢ Recolecci√≥n autom√°tica\n‚Ä¢ Rango configurable"
    infoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    infoLabel.BackgroundTransparency = 1
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.Parent = tab
end

function MenuManager:CreateChestsTab(parent)
    local tab = Instance.new("Frame")
    tab.Name = "ChestsTab"
    tab.Size = UDim2.new(1, 0, 1, 0)
    tab.BackgroundTransparency = 1
    tab.Visible = false
    tab.Parent = parent
    
    local autoChests = self:CreateToggle("Auto Cofres", false, tab, 20)
    local chestRange = self:CreateSlider("Rango Cofres", 10, 50, 30, tab, 70)
end

function MenuManager:CreateSkillsTab(parent)
    local tab = Instance.new("Frame")
    tab.Name = "SkillsTab"
    tab.Size = UDim2.new(1, 0, 1, 0)
    tab.BackgroundTransparency = 1
    tab.Visible = false
    tab.Parent = parent
    
    local autoSkills = self:CreateToggle("Auto Entrenar", false, tab, 20)
    local skillRange = self:CreateSlider("Rango Enemigos", 10, 40, 25, tab, 70)
end

function MenuManager:CreateSettingsTab(parent)
    local tab = Instance.new("Frame")
    tab.Name = "SettingsTab"
    tab.Size = UDim2.new(1, 0, 1, 0)
    tab.BackgroundTransparency = 1
    tab.Visible = false
    tab.Parent = parent
    
    local debugToggle = self:CreateToggle("Modo Debug", true, tab, 20)
end

function MenuManager:CreateToggle(label, default, parent, yPosition)
    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(1, -20, 0, 30)
    toggle.Position = UDim2.new(0, 10, 0, yPosition)
    toggle.Text = label .. ": " .. (default and "ON" or "OFF")
    toggle.TextColor3 = default and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    toggle.BorderSizePixel = 0
    toggle.Parent = parent
    
    toggle.MouseButton1Click:Connect(function()
        local newState = not (toggle.Text:find("ON") ~= nil)
        toggle.Text = label .. ": " .. (newState and "ON" or "OFF")
        toggle.TextColor3 = newState and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
        
        -- Actualizar configuraci√≥n
        if RezoHub then
            local configKey = label:gsub(" ", "")
            RezoHub.Config[configKey] = newState
        end
    end)
    
    return toggle
end

function MenuManager:CreateSlider(label, min, max, default, parent, yPosition)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(1, -20, 0, 40)
    sliderFrame.Position = UDim2.new(0, 10, 0, yPosition)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = parent
    
    local labelText = Instance.new("TextLabel")
    labelText.Size = UDim2.new(1, 0, 0, 20)
    labelText.Position = UDim2.new(0, 0, 0, 0)
    labelText.Text = label .. ": " .. default
    labelText.TextColor3 = Color3.fromRGB(255, 255, 255)
    labelText.BackgroundTransparency = 1
    labelText.TextXAlignment = Enum.TextXAlignment.Left
    labelText.Parent = sliderFrame
    
    return labelText
end

function MenuManager:SwitchTab(tabName)
    -- Ocultar todas las pesta√±as
    for _, child in ipairs(self.MainFrame.ContentFrame:GetChildren()) do
        if child:IsA("Frame") then
            child.Visible = false
        end
    end
    
    -- Mostrar pesta√±a seleccionada
    local targetTab = self.MainFrame.ContentFrame:FindFirstChild(tabName .. "Tab")
    if targetTab then
        targetTab.Visible = true
    end
end

function MenuManager:SetupDragFunctionality()
    local dragging = false
    local dragInput, dragStart, startPos
    
    self.MainFrame.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    self.MainFrame.Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            self.MainFrame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X,
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

function MenuManager:CreateFooter()
    local footer = Instance.new("Frame")
    footer.Name = "Footer"
    footer.Size = UDim2.new(1, 0, 0, 30)
    footer.Position = UDim2.new(0, 0, 1, -30)
    footer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    footer.BorderSizePixel = 0
    footer.Parent = self.MainFrame
    
    local version = Instance.new("TextLabel")
    version.Size = UDim2.new(1, -10, 1, 0)
    version.Position = UDim2.new(0, 10, 0, 0)
    version.Text = "REZO HUB v1.0 | Blox Fruits"
    version.TextColor3 = Color3.fromRGB(150, 150, 150)
    version.BackgroundTransparency = 1
    version.TextXAlignment = Enum.TextXAlignment.Left
    version.Parent = footer
end

return MenuManager
    -- Aqu√≠ ir√≠an los manejadores de eventos para los controles
end

return MenuManager
